<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Produced Under Scarcity &middot; Akhil Rao's blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://akhilrao.github.io/public/css/poole.css">
  <link rel="stylesheet" href="https://akhilrao.github.io/public/css/syntax.css">
  <link rel="stylesheet" href="https://akhilrao.github.io/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://akhilrao.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="https://akhilrao.github.io/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  
  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
<br>
<br>
  <div class="sidebar-item" style="align:center">
      <img src="http://www.gravatar.com/avatar/26915e5b3ffb1eb6bbba2f069f4b0a8e?s=120" />
      
    <p>Economics, data science, and words about things</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://akhilrao.github.io/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/blog/categories/">Categories</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/akhilrao/archive/v0.1.0.zip">Download</a>
    <a class="sidebar-nav-item" href="https://github.com/akhilrao">GitHub project</a>
    <span class="sidebar-nav-item">Currently v0.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://akhilrao.github.io/" title="Home">Produced Under Scarcity</a>
            <small>Akhil Rao's blog</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://akhilrao.github.io//micro%20theory/2016/07/26/paper-review-macauley-orbit-value-model/">
        Paper review - *"Allocation of Orbit and Spectrum Resources for Regional Communications - What's at Stake?"*
      </a>
    </h1>

    <span class="post-date">26 Jul 2016</span>

    <p>Here I review Molly Macauley’s 1998 paper, <a href="http://www.journals.uchicago.edu/doi/10.1086/467411">“Allocation of Orbit and Spectrum Resources for Regional Communications: What’s at Stake?”</a>, published in <em>The Journal of Law and Economics</em>.</p>

<p>Molly Macauley <a href="https://www.washingtonpost.com/local/obituaries/molly-k-macauley-researcher-on-economics-and-space-science-dies-at-59/2016/07/20/b3d309c4-4dd9-11e6-aa14-e0c1087f7583_story.html">recently died</a> in Baltimore. As a researcher newly entering this field I’m not qualified to describe her many contributions to environmental and space economics. However, I can say that I have yet to find an area of space economics where Dr. Macauley has not written something insightful and policy-relevant. I have found her work tremendously inspirational and a useful practical guide in thinking about questions in space economics. I didn’t know her personally, and I am sad that I never will. Here is a tribute page, <a href="http://www.rff.org/blog/2016/remembering-molly"><em>Remembering Molly</em></a>.</p>

<h2 id="whats-this-paper-about">What’s this paper about?</h2>

<p>This paper is about the values of slots in geostationary orbits (GEO) and the potential gains from improving GEO slot use regulations. The paper has two main goals:</p>

<ol>
  <li>
    <p>Develop and estimate an economic model of orbits with locational attributes. The point of this is to calculate the savings of using satellites to meet telecom demand vs. using the “best terrestrial alternative” to meet the same telecome demand. Caveat: The values derived here are not equilibrium values, rather upper bounds on the maximum willingness-to-pay of countries for having satellites in preferred orbital locations.</p>
  </li>
  <li>
    <p>Model and estimate the effects of technological substitution possibilities which would allow orbit users to “economize on the amount of orbit used at any given location”, for example by giving satellites more complex antennae to use allocated spectrum bandwidths more intensively at “prime” orbital locations. Macauley’s argument is that allocating orbits administratively shields users from facing the true costs of that orbit (the value to other users), which reduces the incentive to use orbits more intensively.</p>
  </li>
</ol>

<p>In writing the model, Macauley is drawing on urban economics models of spatial location. A quote from the paper illustrates the argument well:
&gt; “…just as land values increase with proximity to a central business district as commuting and other transportation costs fall, orbit values might be expected to increase at locations that afford the best communications-demand-related coverage…just as an increase in land values leads to substitution toward capital and away from land…so too might an increase in orbit values lead to more capital intensive use of the orbit at preferred locations.”</p>

<p>So in the same way that urban land users in downtown areas use land more intensively (e.g. taller buildings) than users in the suburbs (where buidings are flatter and there is more sprawl), orbit users have incentives to use prime orbits more intensively (more spectrum use per unit of orbit) than users in non-prime locations.</p>

<p>If spectrum congestion weren’t an issue, GEO spacing could be minimum physical safe distance (40 miles or so). To guard against spectrum congestion, regulators mandate separations of 800-1600+ miles. If satellites were closer together, they could
1. communicate at different frequencies, or
2. be situated at noninterfering distances from other satellites communicating at the same frequency, or
3. coordinate the timing of their signal emissions to not interfere (this is apparently practiced by terrestrial spectrum users)</p>

<p>Regulators are concerned with spectrum congestion, but the regulations in place reduce orbit users’ need to use orbit more intensively with these types of spectrum use techniques.</p>

<p>It’s worth noting that there aren’t well-defined property rights for electromagnetic spectrum in orbit. Macauley cites a number of studies on the problems this causes, including <a href="http://www.sciencedirect.com/science/article/pii/0308596178900228">Jackson (1978)</a>, <a href="http://www.sciencedirect.com/science/article/pii/0308596181900525">Levin (1981)</a>, <a href="http://www.sciencedirect.com/science/article/pii/0308596185900369">Levin (1985)</a>, <a href="http://www.sciencedirect.com/science/article/pii/030859619090043Q">Levin (1990)</a>. Some googling turns up other helpful writings on the issue of property rights in space, like this <a href="https://www.aei.org/publication/slicing-the-geostationary-pie-property-rights-in-orbit/print/">AEI article by Macauley and Paul R. Portney</a> and this <a href="https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-SM.2012-4-2014-PDF-E.pdf">ITU report on economic aspects of spectrum management</a>. <a href="http://www.jstor.org/stable/1818780">Macauley (1986)</a> also discusses the issue of spectrum regulation as it relates to communications satellites.</p>

<p>There is a substantial economic literature on spectrum allocation in general which I won’t discuss here. <a href="http://www.acma.gov.au/~/media/mediacomms/Research%20library%20reports%20old/pdf/Economics%20of%20spectrum%20management%20pdf.pdf">This paper review</a> seems like a good place to start thinking about potential contributions. In general GEO and spectrum use for telecom purposes had been studied quite a bit by economists when Macauley wrote this paper.</p>

<p>GEO slot use is tightly linked to electromagnetic spectrum use in orbit. Satellite use thus suffers from at least two market failures: one caused by misallocation of orbital slots, and one caused by misallocation of spectrum. These issues are fundamentally tied to the common-pool resource nature of orbital slots and spectrum.</p>

<h2 id="models-and-data">Models and data</h2>

<blockquote>
  <p>The market for satellite-related services ultimately determines the derived demand for a location in the orbit.</p>
</blockquote>

<p>Macauley builds two related models in this paper, the second a generalization of the first. The first assumes that orbits and spectrum are used in fixed proportions. I understand this to mean “spectrum use must be the same at any location in GEO”. The second relaxes this assumption by allowing orbit and spectrum to be substitutable inputs in a Cobb-Douglas production function for satellite services. The first case corresponds to a Cobb-Douglas production function with equal exponents for orbit and spectrum.</p>

<p>In both models, the telecom service provider has a choice between using satellite or terrestrial technologies to meet the exogenous telecom service demand between country pairs <script type="math/tex">jk</script>. The advantage of using satellites is that they can cheaply connect any two countries <script type="math/tex">j</script> and <script type="math/tex">k</script> within the satellite’s Field of View (FOV). Terrestrial technologies are affected by the distance between <script type="math/tex">j</script> and <script type="math/tex">k</script> and require signal repeaters.</p>

<p>Macauley describes how FOV is determined at each location in the beginning of the paper. I will not discuss it here.</p>

<h3 id="fixed-proportions">Fixed proportions</h3>

<p>This model provides the foundation for the analysis in this paper. It is a simulation model of a cost-minimizing telecom service producer’s choice of service provision technology. The equations which define the model are</p>

<p><em>Terrestrial technologies</em>
<script type="math/tex">% <![CDATA[
\begin{align}
Q_i &= Q(H_i) \cr
C_{ijk} &= C_i(Q_{jk},Z_{jk}, \delta_i(\bar{Q}_i))
\end{align} %]]></script></p>

<p>where <script type="math/tex">Q()</script> represents the output of communications services, and <script type="math/tex">C()</script> represents the cost of the technology in use.</p>

<p><script type="math/tex">i = 1, \dots, m</script> indexes the potential terrestrial technologies which could connect country pairs <script type="math/tex">jk</script>; <script type="math/tex">H_i</script> represents the hardware which forms the connection and associated costs (e.g. coastal landing rights for undersea cable, overland rights of way for terrestrial cable); <script type="math/tex">Z_{jk}</script> represents the distance between countries <script type="math/tex">j</script> and <script type="math/tex">k</script>.</p>

<p><em>Satellites</em>
<script type="math/tex">% <![CDATA[
\begin{align}
Q_s &= Q(A, S, H_s) \cr
C_{sjk} &= C_s(Q_{jk}, \delta_s(\bar{Q}_s); L_1, \dots, L_{\tau}) \text{ for } (j,k) \in FOV
\end{align} %]]></script></p>

<p>where <script type="math/tex">A</script> represents an orbital slot, <script type="math/tex">S</script> represents spectrum, and <script type="math/tex">H_s</script> represents the satellite hardware and associated costs (including launch costs); <script type="math/tex">L_1, \dots, L_{\tau}</script> represent the exogenously-given possible orbital locations indexed <script type="math/tex">1 - \tau</script>.</p>

<p><em>Demand and indivisibilities</em>
<script type="math/tex">% <![CDATA[
\begin{align}
\delta(\bar{Q}) &= \sum_{j=1}^{n-1} \sum_{k=j+1}^{n} Q_{jk}, ~~0< \delta \leq 1 \cr
Q_{jk}^D \leq \bar{Q}_{jk}
\end{align} %]]></script></p>

<p><script type="math/tex">bar{Q}</script> represents the exogenously-given total quantity of communications demand for the set of <script type="math/tex">n</script> countries that want to be connected. <script type="math/tex">\delta(\bar{Q})</script> reflects individibilities in the various technologies when they operate as a system; I interpret this as meaning that these capacity investments are discrete and not continuous in nature, so that the system’s installed capacity will typically exceed demand on a single country-pair route.  I am not sure what “<script type="math/tex">% <![CDATA[
0< \delta \leq 1 %]]></script>” refers to - maybe there’s a typo where a <script type="math/tex">\delta</script> exponent is missing?
<script type="math/tex">Q_{jk}^D</script> measures the “busy hour” traffic between <script type="math/tex">j</script> and <script type="math/tex">k</script>, and implies a constraint on the facilities - they must be able to serve this demand at an acceptable degree of service (i.e. low probability of receiving a busy signal).</p>

<p>This setup lets Macauley calculate the cost savings from using satellites over terrestrial technology as</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
min TC(L_i) &= \sum_{j=1}^{n-1} \sum_{k=j+1}^{n} C_{jk} (Q; \delta, z, L_i) \cr
R(L_i) &= TC(L_i) - TC(L_x)
\end{align} %]]></script>

<p>where <script type="math/tex">TC()</script> represents the total cost to serve <script type="math/tex">n</script> countries that want to be connected using a satellite located at location <script type="math/tex">L_i</script>. <script type="math/tex">L_x</script> represents the next-best available orbital slot that could connect those <script type="math/tex">n</script> countries. <script type="math/tex">R(L_i)</script> represents the cost savings of using the most-preferred orbital slot for a set of countries in a region. The outside option of not using satellite technology to connect <script type="math/tex">n</script> countries is represented by <script type="math/tex">R(L_i) = R(L_i) - R(L_i) = 0</script>.</p>

<p>The phrase “prime orbit location” refers to the orbit location with a maximum value for a specific nation. I am thinking about it as the GEO location above a country which puts the most important countries it communicates with in the satellite’s FOV, i.e. a satellite in prime location for country <script type="math/tex">j</script> maximizes the value of communications between <script type="math/tex">j</script> and the countries it wishes to communicate with, <script type="math/tex">\{k\}</script>. In South America, this definition maps “prime locations” to “locations which cover the most other countries <script type="math/tex">k</script>”. In North America, population density and communications patterns break this mapping. For example, site values in the Pacific Rim are high when just Canada and the US are in view, excluding many of the other PacRim countries.</p>

<h3 id="variable-proportions">Variable proportions</h3>

<p>The supply and demand equations for the variable proportions model are
<script type="math/tex">% <![CDATA[
\begin{align}
X_s(u) &= DA(u)^{\alpha}S(u)^{1-\alpha} \cr
X_d(u) &= \beta y^{\theta_1} p(u)^{\theta_2}
\end{align} %]]></script></p>

<p>where <script type="math/tex">D</script> is a scale parameter, <script type="math/tex">A</script> and <script type="math/tex">S</script> are quantities of orbit and spectrum, <script type="math/tex">\alpha \in (0,1)</script> is the Cobb-Douglas exponent; <script type="math/tex">\beta</script> is a scale parameter, <script type="math/tex">y</script> is income, <script type="math/tex">p</script> is price, and <script type="math/tex">\theta_1</script> and <script type="math/tex">\theta_2</script> are the income and price elasticities respectively. <script type="math/tex">u</script> measures the satellite location relative to prime locations.</p>

<p>This model also has an equation for locational equilibrium, as
<script type="math/tex">p'(u) X_d(u) = -t(u)</script></p>

<p>where <script type="math/tex">t(u)</script> represents the marginal cost of connecting cities outside the view of a satellite at location <script type="math/tex">u</script>, i.e. the extra costs incurred to get to the edge of the satellite’s FOV.
Macauley estimates <script type="math/tex">t(u)</script> using Mathematica to fit a polynomial of the form
<script type="math/tex">t(u) = \gamma \frac{e^{(u - \bar{u})/\sigma}}{1 + e^{(u - \bar{u})/\sigma}}</script></p>

<p>where <script type="math/tex">u - \bar{u}</script> measures distance in longitudinal degrees at <script type="math/tex">u</script> from the prime orbit location, <script type="math/tex">\bar{u}</script>.</p>

<p>These equations allow Macauley to derive an equation for orbital slot value (derivation in Appendix B). It’s a complicated equation which I won’t describe here.</p>

<h3 id="data">Data</h3>

<p>The models are estimated using data obtained from engineering estimates (for the technology) and trade publications (for volume and value of calls). Macauley states that demand estimates are an order-of-magnitude proxy only. The data are described in Appendix A.</p>

<h2 id="discussion">Discussion</h2>

<p>Macauley’s stated purpose in writing this paper was to figure out the potential gains from allowing more flexible orbit/spectrum use patterns. This is not what my current space economics project is about; I am looking at a general model of orbit choice and debris production. This model is specifically designed for telecommunications satellites in GEO, while the model I am writing is valid for any type of satellite in any not-too-elliptical orbital regime (with a focus on LEO).</p>

<p>However, I had not thought seriously about spectrum use prior to reading this paper. Now it seems obvious to me that most satellite applications require not only an orbital slot (or path) but also some electromagnetic spectrum. An imaging satellite which requires images to be physically retrieved from it is not very useful. I suppose tourist shuttles that take people to LEO and back down have less need for spectrum, but they would still need to be able to coordinate with ground-based observers and other satellites to ensure a safe trip.</p>

<p>The question before me now is, how relevant is spectrum use to my applications? I think it’s probably of second-order importance to modeling debris production from satellite operations outside GEO (say, in LEO), but might be of first-order importance in GEO. I was on the fence about incorporating locational attributes of orbital slots/paths in a general sort of way, but now I think those attributes are an important feature.</p>

<p>Back to this paper: Macauley points out that the Cobb-Douglas form is restrictive, and defends the use of this functional form in two ways:</p>

<ol>
  <li>by appealing to some anecdotal engineering about the use of orbit and spectrum. The Cobb-Douglas form’s restrictions implies that the ratio of input use be proportional to the ratio of factor prices. On the basis of published operating parameters, satellites in prime locations use a unit of orbit 7-10 times more intensively than in non-prime locations, through techniques like spectrum re-use. The orbit values she estimates with the first model imply values of prime locations that are approximately 10 times larger than in non-prime locations. So the Cobb-Douglas form may not be too bad an approximation in this setting.</li>
  <li>by pointing out that data are unavailable to estimate all the parameters of a more flexible functional form.</li>
</ol>

<p>I’d like to write a paper about GEO use specifically; estimating this model with more data, or extending this model, might be good places to start.</p>

<p>Overall I really liked this paper. I thought it was insightful, well researched and thought through, and very helpful for someone getting started in this area.</p>

    <a href="/micro%20theory/2016/07/26/paper-review-macauley-orbit-value-model/#disqus_thread">View or add comments</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://akhilrao.github.io//econometrics/2016/07/16/lasso-ols-sim-1/">
        Looking at LASSO - parameter estimation in a contrived example
      </a>
    </h1>

    <span class="post-date">16 Jul 2016</span>

    <p>I’ve been thinking about LASSO a lot over the last few months. I first heard about <a href="http://andrewgelman.com/?s=LASSO">LASSO over at Gelman’s blog</a> a few years ago (I can’t remember the exact post), but didn’t follow most of the discussion or spend much time trying. I didn’t really understand what the fuss was about until last semester, when my econometrics professor showed me some papers in spatial econometrics using LASSO (<a href="http://www.cireqmontreal.com/wp-content/uploads/2015/02/manresa.pdf">this one by Elena Manresa</a> and <a href="http://stats.lse.ac.uk/lam/RSPT.pdf">this one by Cliff Lam and Pedro Souza</a>). Going through those posts again, regularized regressions are now the coolest thing to me since the HydroFlask.</p>

<p>My dad and I visited some relatives in northwest Karnataka last week where I had limited internet/distractions, so I finally threw together a LASSO simulation I’ve been thinking about since that econometrics class. My goal was to see how LASSO’s parameter estimation compares to OLS’s. I don’t have any new results; everything here has been derived or discussed in greater detail somewhere else. This post is to convince myself of some of LASSO’s properties relative to OLS without doing derivations, to get familiar with the <code class="highlighter-rouge">glmnet</code> package, and to procrastinate on other work I should be doing.</p>

<h2 id="what-is-the-lasso">What is the LASSO?</h2>

<p>The idea with OLS is to estimate the model <script type="math/tex">Y = X \beta + \epsilon</script> by solving</p>

<script type="math/tex; mode=display">\min_{\beta} (Y - X \beta)^2</script>

<p>This results in an estimator for <script type="math/tex">\beta</script> which is <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Markov_theorem">unbiased, consistent, and even efficient under certain conditions</a>. It’s easy to compute and interpret, its assumptions and inferential properties are well-studied… it’s pretty much the first model taught in a lot of econometrics classes and the first tool applied economists reach for to estimate things.</p>

<p>The idea with LASSO is to add a penalty to the problem that is increasing in the dimension of the coefficient vector <script type="math/tex">\beta</script>, i.e. to solve</p>

<script type="math/tex; mode=display">\min_{\beta} (Y - X \beta)^2 + \lambda \| \beta \|_1</script>

<p>where <script type="math/tex">\| \beta \|_1</script> is the <script type="math/tex">L1</script> norm of the vector <script type="math/tex">\beta</script>. <script type="math/tex">\lambda</script> is a parameter that controls how severe the penalty for a higher-dimensional or larger <script type="math/tex">\beta</script> is - bigger <script type="math/tex">\lambda</script> means a sparser model. It is typically tuned through cross-validation. This procedure results in a <a href="https://arxiv.org/pdf/0808.0967.pdf">biased</a> but <a href="http://www.jmlr.org/papers/volume7/zhao06a/zhao06a.pdf">consistent</a> estimator of <script type="math/tex">\beta</script>.</p>

<p>Note that the consistency described in the Zhao paper at the “consistent” link is not the same consistency that econometricians usually talk about; the former is model selection consistency, the latter is parameter estimation consistency. The Zhao paper has some discussion of this distinction, and refers to <a href="http://www.stat.rice.edu/~gallen/knight_fu_2000_lasso.pdf">Knight and Fu (2000) </a> for proofs of estimation consistency and asymptotic properties of a class of regularized estimators which include LASSO as a special case.</p>

<p>That’s all I’ll say about LASSO here. There’s a lot of discussion of the LASSO online. Rob Tibshirani has a good introduction with references <a href="http://statweb.stanford.edu/~tibs/lasso.html">here</a>, the <a href="https://en.wikipedia.org/wiki/Lasso_(statistics)">wikipedia page</a> is also decent, and googling will turn up a lot more resources.</p>

<h2 id="simulations">Simulations</h2>

<p>I used R’s <code class="highlighter-rouge">glmnet</code> package to run the LASSO estimations. My main reference was <a href="https://cran.r-project.org/web/packages/glmnet/vignettes/glmnet_beta.html">this vignette</a> by Trevor Hastie and Junyang Qian, supplemented by some searches that I can’t remember now.</p>

<h3 id="dgp-and-code">DGP and code</h3>

<p>This is how I made the data generating process:</p>

<ol>
  <li>draw 100 “seeds” <script type="math/tex">\omega_i</script> from a uniform distribution over <script type="math/tex">[0,1]</script></li>
  <li>sample <code class="highlighter-rouge">n_covs</code> of these seeds to generate sines <script type="math/tex">X_i = \sin(\pi \omega_i  t)</script>, where <script type="math/tex">t</script> runs from 1 to <code class="highlighter-rouge">n_obs</code></li>
  <li>put these sines together in a matrix <script type="math/tex">X</script>, and generate a dependent variable <script type="math/tex">Y = X_1 + 3 X_2 - 5 X_3 + 7 X_4 - 9 X_5 + 11 X_6 + R</script>, where <script type="math/tex">R \sim N(0,1)</script> is a standard normal random variable to add a little noise</li>
</ol>

<p>This gives me a bunch of randomly initialized deterministic regressors and a noisy linear combination of a few of them. Since OLS is unbiased and consistent, it should estimate the coefficients of the <script type="math/tex">X_i</script>s correctly. Since there are only 100 observations it probably won’t be super precise but on average it should still be close.</p>

<p>For each number of covariates, I estimated OLS and LASSO regressions 1000 times from steps 2 and 3, storing the coefficients in a matrix. My R code below might make this process clearer.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span>

<span class="n">lasso_ols_mc</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">n_covs</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span> <span class="p">{</span>
<span class="n">seeds</span> <span class="o">&lt;-</span> <span class="n">runif</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="n">min</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">max</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="c1">#uniform draws for numbers to plug into sines in X
### initialize coefficient storage
</span><span class="n">ols_coefs</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">n_covs</span><span class="p">)</span>
<span class="n">lasso_min</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">n_covs</span><span class="p">)</span>

<span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">n_iter</span><span class="p">)</span> <span class="p">{</span> <span class="c1">#monte carlo loop  
#### The DGP  
</span>  <span class="n">seeds_sample</span> <span class="o">&lt;-</span> <span class="n">sample</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">n_covs</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span> <span class="c1">#random sample from the seeds... not super reproducible :(
</span>  <span class="n">step</span> <span class="o">&lt;-</span> <span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="n">n_obs</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="c1">#time step 
</span>  <span class="n">X</span> <span class="o">&lt;-</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="n">n_obs</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">n_covs</span><span class="p">)</span> <span class="c1">#matrix to store sines in columns
</span>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">n_covs</span><span class="p">){</span> <span class="c1">#loop over columns to create n_covs many deterministic regressors
</span>    <span class="n">X</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">sinpi</span><span class="p">(</span><span class="n">seeds_sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">step</span><span class="p">)</span> <span class="c1">#sines - deterministic regressors
</span>  <span class="p">}</span>
  
<span class="c1">#### The Y variable
</span>  <span class="n">Y</span> <span class="o">&lt;-</span> <span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> <span class="m">3</span><span class="o">*</span><span class="n">X</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="o">-</span> <span class="m">5</span><span class="o">*</span><span class="n">X</span><span class="p">[,</span><span class="m">3</span><span class="p">]</span> <span class="o">+</span> <span class="m">7</span><span class="o">*</span><span class="n">X</span><span class="p">[,</span><span class="m">4</span><span class="p">]</span> <span class="o">-</span> <span class="m">9</span><span class="o">*</span><span class="n">X</span><span class="p">[,</span><span class="m">5</span><span class="p">]</span> <span class="o">+</span> <span class="m">11</span><span class="o">*</span><span class="n">X</span><span class="p">[,</span><span class="m">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">rnorm</span><span class="p">(</span><span class="n">n_obs</span><span class="p">)</span> <span class="c1">#linear combination of sines + gaussian noise
</span>  
<span class="c1">#### OLS fit
</span>  <span class="n">olsfit</span> <span class="o">&lt;-</span> <span class="n">lm</span><span class="p">(</span><span class="n">Y</span> <span class="o">~</span> <span class="n">X</span><span class="p">)</span>
  <span class="n">summary</span><span class="p">(</span><span class="n">olsfit</span><span class="p">)</span>
  <span class="n">ols_coefs</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">ols_coefs</span><span class="p">,</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">olsfit</span><span class="p">))[</span><span class="m">2</span><span class="o">:</span><span class="p">(</span><span class="n">n_covs</span><span class="m">+1</span><span class="p">),</span><span class="m">1</span><span class="p">])</span> <span class="c1">#store coefficients from this run
</span>  
<span class="c1">#### LASSO fit
</span>  <span class="n">lassofit</span> <span class="o">&lt;-</span> <span class="n">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">nlambda</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>
  <span class="n">lasso_min</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">lasso_min</span><span class="p">,</span><span class="n">as.numeric</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">lassofit</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">"lambda.min"</span><span class="p">,</span> <span class="n">exact</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="p">(</span><span class="n">n_covs</span><span class="m">+1</span><span class="p">),</span><span class="m">1</span><span class="p">]))</span> <span class="c1">#store coefficients from this run
</span>
<span class="p">}</span>

<span class="c1">#### Cleaning up a bit
</span><span class="n">ols_coefs</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">ols_coefs</span><span class="p">[</span><span class="m">-1</span><span class="p">,],</span> <span class="n">row.names</span><span class="o">=</span><span class="n">as.character</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">dim</span><span class="p">(</span><span class="n">ols_coefs</span><span class="p">)[</span><span class="m">1</span><span class="p">])))</span>
<span class="n">lasso_min</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">lasso_min</span><span class="p">[</span><span class="m">-1</span><span class="p">,],</span> <span class="n">row.names</span><span class="o">=</span><span class="n">as.character</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">dim</span><span class="p">(</span><span class="n">lasso_min</span><span class="p">)[</span><span class="m">1</span><span class="p">])))</span>

<span class="c1">#### Return list of coefficients
</span><span class="n">coefs</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">()</span>
<span class="n">coefs</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">ols_coefs</span>
<span class="n">coefs</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">lasso_min</span>

<span class="k">return</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>The coefficient storage could have been done more elegantly and I don’t like those <code class="highlighter-rouge">rbind()</code> calls… but effort is costly and this is produced under scarcity.</p>

<p>Anyway, the function <code class="highlighter-rouge">lasso_ols_mc()</code> takes three arguments: <code class="highlighter-rouge">n_covs</code>, the number of covariates to generate; <code class="highlighter-rouge">n_obs</code>, the number of observations to generate; <code class="highlighter-rouge">n_iter</code>, the number of iterations to run. It returns a list with two dataframes of dimension <code class="highlighter-rouge">n_iter</code> by <code class="highlighter-rouge">n_covs</code>: the first is the OLS coefficients, and the second is the LASSO coefficients. The code is in the file <code class="highlighter-rouge">simulation.r</code> <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/lassoOlsSim/simulation.r">here</a>.</p>

<p>I’m using <code class="highlighter-rouge">cv.glmnet()</code> instead of <code class="highlighter-rouge">glmnet()</code> to get the estimated coefficients from the penalization parameter <script type="math/tex">\lambda</script> which minimizes the cross-validated errors. This <a href="http://stats.stackexchange.com/questions/77546/how-to-interpret-glmnet">Stack Exchange post</a> has a good discussion of the use of <code class="highlighter-rouge">cv.glmnet()</code> versus <code class="highlighter-rouge">glmnet()</code> and how that relates to <script type="math/tex">\lambda</script>.</p>

<h3 id="simulation-1-25-covariates">Simulation 1: 25 covariates</h3>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"C:/Users/Akhil/Documents/akhilrao.github.io/public/code/lassoOlsSim/simulation.Rdata"</span><span class="p">)</span>

<span class="n">sim_25</span> <span class="o">&lt;-</span> <span class="n">lasso_ols_mc</span><span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">1000</span><span class="p">)</span>

<span class="n">ols_coefs</span> <span class="o">&lt;-</span> <span class="n">sim_25</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="n">lasso_min</span> <span class="o">&lt;-</span> <span class="n">sim_25</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="n">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="c1">#I like decimal notation
</span><span class="n">colMeans</span><span class="p">(</span><span class="n">ols_coefs</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##        X1        X2        X3        X4        X5        X6        X7 
##   0.84575   2.79689  -5.39146   6.91616 -10.39828  11.14851   0.23271 
##        X8        X9       X10       X11       X12       X13       X14 
##  -0.16579   0.25008   0.06273   0.60091  -0.50771   0.14841   0.18313 
##       X15       X16       X17       X18       X19       X20       X21 
##  -0.48205   0.06443   0.22578   0.33808   0.80858  -1.80170  -1.01977 
##       X22       X23       X24       X25 
##   0.98723   0.30708   1.78747   0.07162</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">colMeans</span><span class="p">(</span><span class="n">lasso_min</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##         V1         V2         V3         V4         V5         V6 
##  0.8551006  2.8313675 -4.7997349  6.7857505 -8.7650122 10.7999512 
##         V7         V8         V9        V10        V11        V12 
##  0.0112456  0.0081712  0.0058198 -0.0007110 -0.0009387  0.0024224 
##        V13        V14        V15        V16        V17        V18 
##  0.0081600 -0.0045956 -0.0002659  0.0052694  0.0081007  0.0034213 
##        V19        V20        V21        V22        V23        V24 
##  0.0003531  0.0076995  0.0004855  0.0120161  0.0125994  0.0056955 
##        V25 
##  0.0058837</code></pre></figure>

<p>The first 6 numbers should be +1, +3, -5, +7, -9, +11, and all the rest should be 0. OLS and LASSO are both close on the first 6, with LASSO a little closer on the rest.</p>

<h3 id="simulation-2-50-covariates">Simulation 2: 50 covariates</h3>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"C:/Users/Akhil/Documents/akhilrao.github.io/public/code/lassoOlsSim/simulation.Rdata"</span><span class="p">)</span>

<span class="n">sim_50</span> <span class="o">&lt;-</span> <span class="n">lasso_ols_mc</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">1000</span><span class="p">)</span>

<span class="n">ols_coefs</span> <span class="o">&lt;-</span> <span class="n">sim_50</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="n">lasso_min</span> <span class="o">&lt;-</span> <span class="n">sim_50</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="n">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="c1">#I like decimal notation
</span><span class="n">colMeans</span><span class="p">(</span><span class="n">ols_coefs</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##        X1        X2        X3        X4        X5        X6        X7 
##    45.621   -39.780    -7.825  -109.538 -1566.738   -19.541   118.284 
##        X8        X9       X10       X11       X12       X13       X14 
##    -4.013   -67.543   -59.812  -147.680    30.056  -227.749   189.434 
##       X15       X16       X17       X18       X19       X20       X21 
##    -8.550    35.778  -173.203   -44.160    27.836   -32.681    56.185 
##       X22       X23       X24       X25       X26       X27       X28 
##  -112.021   -48.255     1.190    48.058   -57.421   -67.878   279.999 
##       X29       X30       X31       X32       X33       X34       X35 
##     9.445    66.104     5.706   108.343     5.123     7.835  -168.868 
##       X36       X37       X38       X39       X40       X41       X42 
##    14.550    34.462    58.293   185.393   -31.833    18.288  1964.648 
##       X43       X44       X45       X46       X47       X48       X49 
##   -10.704   -72.467   177.646  -294.309    42.899        NA  -340.436 
##       X50 
##   175.847</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">colMeans</span><span class="p">(</span><span class="n">lasso_min</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##         V1         V2         V3         V4         V5         V6 
##  0.8015310  2.7677204 -4.7082946  6.6515331 -8.6152915 10.6241727 
##         V7         V8         V9        V10        V11        V12 
##  0.0130475  0.0008572  0.0124773  0.0002354  0.0095255  0.0112302 
##        V13        V14        V15        V16        V17        V18 
## -0.0021430  0.0076620  0.0008248  0.0020195  0.0016123  0.0021281 
##        V19        V20        V21        V22        V23        V24 
##  0.0021809  0.0028006  0.0122234  0.0115460  0.0021777  0.0034436 
##        V25        V26        V27        V28        V29        V30 
## -0.0031613  0.0086550  0.0061313  0.0149392  0.0016341  0.0014897 
##        V31        V32        V33        V34        V35        V36 
##  0.0089855  0.0115552  0.0050156  0.0148793  0.0016785 -0.0067179 
##        V37        V38        V39        V40        V41        V42 
##  0.0063458  0.0048662  0.0099795  0.0131269  0.0038804 -0.0015681 
##        V43        V44        V45        V46        V47        V48 
## -0.0009201  0.0020819  0.0059797  0.0012738  0.0069779  0.0040313 
##        V49        V50 
##  0.0086625  0.0026937</code></pre></figure>

<p>The first 6 numbers should be +1, +3, -5, +7, -9, +11, and all the rest should be 0. OLS is being a little silly now… LASSO is close on the first 6, and solid on the rest.</p>

<h3 id="simulation-3-75-covariates">Simulation 3: 75 covariates</h3>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"C:/Users/Akhil/Documents/akhilrao.github.io/public/code/lassoOlsSim/simulation.Rdata"</span><span class="p">)</span>

<span class="n">sim_75</span> <span class="o">&lt;-</span> <span class="n">lasso_ols_mc</span><span class="p">(</span><span class="m">75</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">1000</span><span class="p">)</span>

<span class="n">ols_coefs</span> <span class="o">&lt;-</span> <span class="n">sim_75</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="n">lasso_min</span> <span class="o">&lt;-</span> <span class="n">sim_75</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="n">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="c1">#I like decimal notation
</span><span class="n">colMeans</span><span class="p">(</span><span class="n">ols_coefs</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##        X1        X2        X3        X4        X5        X6        X7 
##   34430.4  -63493.0  -87764.5    8139.2   -3973.4   77824.9    7663.7 
##        X8        X9       X10       X11       X12       X13       X14 
##  229655.9   -9961.2   53668.5    1506.1   84036.2  -97414.8 -200738.6 
##       X15       X16       X17       X18       X19       X20       X21 
##  -94069.3    7208.0  -17470.4    3016.7  -33336.0  112707.8  -74305.2 
##       X22       X23       X24       X25       X26       X27       X28 
##  -57560.4  -12128.7 -212583.1  196011.4   14389.8  145308.5  -21893.7 
##       X29       X30       X31       X32       X33       X34       X35 
##   16574.2  -33854.0   53555.7     715.7  -31256.4  -59375.7  -50588.8 
##       X36       X37       X38       X39       X40       X41       X42 
##  147967.5  -10886.2   22279.1  -62503.2  -30260.0  -11028.0  -63481.6 
##       X43       X44       X45       X46       X47       X48       X49 
##    -487.8    8418.9  -37660.0    4863.7  197359.9   22782.4  -48267.1 
##       X50       X51       X52       X53       X54       X55       X56 
##    5194.4   70943.0   13752.5     328.8   10425.9  -15728.8    1447.4 
##       X57       X58       X59       X60       X61       X62       X63 
##        NA        NA   -5695.4        NA        NA        NA        NA 
##       X64       X65       X66       X67       X68       X69       X70 
##        NA        NA        NA        NA        NA        NA        NA 
##       X71       X72       X73       X74       X75 
##        NA        NA        NA        NA        NA</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">colMeans</span><span class="p">(</span><span class="n">lasso_min</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##          V1          V2          V3          V4          V5          V6 
##  0.74985507  2.67795119 -4.57457239  6.57015556 -8.51695515 10.53733526 
##          V7          V8          V9         V10         V11         V12 
##  0.01334905  0.00757007  0.00078230 -0.00277604  0.01200334 -0.00109266 
##         V13         V14         V15         V16         V17         V18 
##  0.00281474 -0.00030673  0.00028960  0.00372971  0.00086233 -0.00947773 
##         V19         V20         V21         V22         V23         V24 
## -0.00504350  0.00167887  0.00731918  0.01227472  0.00333442  0.00653620 
##         V25         V26         V27         V28         V29         V30 
##  0.00472042  0.00918587  0.00877708 -0.00272863 -0.00129686  0.00784940 
##         V31         V32         V33         V34         V35         V36 
## -0.00596610  0.00628460  0.00388768  0.01356444  0.00592269 -0.00004759 
##         V37         V38         V39         V40         V41         V42 
##  0.00371287  0.00170037  0.00625622  0.00320188  0.00325778  0.00603352 
##         V43         V44         V45         V46         V47         V48 
##  0.00319677  0.00579496  0.00106068  0.01256782  0.01092158  0.01242250 
##         V49         V50         V51         V52         V53         V54 
##  0.00192769 -0.00797062  0.00446120  0.00478225  0.00569254  0.01142434 
##         V55         V56         V57         V58         V59         V60 
##  0.01072754  0.00495753  0.00329634  0.00429706  0.00331320  0.00041993 
##         V61         V62         V63         V64         V65         V66 
## -0.00057534  0.00516571  0.00664865  0.00994866  0.00271078  0.00925352 
##         V67         V68         V69         V70         V71         V72 
##  0.00785356 -0.00154720  0.00700347 -0.00048195 -0.00261776  0.00690537 
##         V73         V74         V75 
##  0.00469327  0.00113490 -0.00432958</code></pre></figure>

<p>The first 6 numbers should be +1, +3, -5, +7, -9, +11, and all the rest should be 0. Go home OLS, you’re drunk.</p>

<h2 id="discussion">Discussion</h2>

<p>From the results above, it looks like OLS and LASSO are both reasonable choices when the number of covariates <script type="math/tex">p</script> is small relative to the sample size <script type="math/tex">n</script>. LASSO does a better job of estimating irrelevant covariates as 0 - I don’t see how OLS could do as well there. My understanding is that LASSO sets some coefficients to 0 because of the kink in the objective function that the <script type="math/tex">L1</script> penalty adds at 0. The OLS objective function is smooth through 0, so it seems like it should always keep every predictor, even if they’re estimated as really tiny values with big standard errors.</p>

<p>Where LASSO really shines is when <script type="math/tex">p</script> starts getting larger relative to <script type="math/tex">n</script>. In the second and third simulations, OLS produces some pretty ridiculous parameter estimates for both the relevant and irrelevant predictors, while LASSO stays on point - the estimates always have the correct sign and the correct order of magnitude. This <a href="http://stats.stackexchange.com/questions/82466/why-use-lasso-estimates-over-ols-estimates-on-variable-subset">Stack Exchange post</a> has a good discussion of when to use LASSO vs OLS for variable selection. To be fair the sines I generated as covariates are probably fairly correlated on average, so there’s most likely some collinearity messing with the OLS estimates (I think this is what’s going on with all the NAs).</p>

<p>So where and how is LASSO used in economics? I hear it’s not uncommon in financial economics, and I know it’s being applied in spatial econometrics. But I haven’t seen it in the mainstream of applied fields like labor, development, or environmental economics (where reduced-form methods seem to be preferred). There, from what I’ve seen, unregularized approaches like OLS continue to dominate. Why might this be the case?</p>

<p>Spatial is more of a tool-building area than a specific-topic area like financial or labor so simulations can be relevant to the questions of interest, but it makes spatial a less-apt comparison to fields like labor or development. Let’s ignore spatial for the rest of this discussion. If you’re interested in the two spatial econometrics papers using LASSO I mentioned at the beginning of this post, I wrote a short review for that econometrics class which might be useful. You can find it <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/lassoOlsSim/akhil_rao_8838_writeup_final.pdf">here</a>.</p>

<p>Financial has lots of really good data, e.g. high-frequency stock price data, so it makes sense to me that there would be some scope for “fancier” econometrics there. My limited understanding of the questions studied in financial is that they tend to focus more on prediction than policy evaluation, reducing the “interpretability advantage” of OLS over other methods. So this might be a factor that limits LASSO adoption outside of financial. Jim Savage has <a href="http://andrewgelman.com/2015/09/29/how-to-use-lasso-etc-in-political-science/#comment-244882">some interesting comments</a> in this regard - apparently he uses LASSO as a variable selection tool for which interactions to include as controls in a causal model. That seems like a good use of LASSO’s model selection consistency, and is something I’ll probably start doing as well. (As an aside, Jim Savage’s random forest proximity weighting paper mentioned in that comment got me stoked about random forests all over again. I think it’s worth a read if you’re interested in machine learning and econometrics.)</p>

<p>Data quality in other applied fields is a mixed bag. Labor has lots of high-quality data, but development folks I know tell me development doesn’t. In environmental it seems to depend on the question. I don’t know much about industrial organization and trade, but I’ve been told they tend to use more “fancy” econometrics than other fields. Structural vs. reduced-form preferences might play a role in this, and in general I think many researchers in applied fields care more about policy evaluation than prediction (see Jim Savage’s comment above).</p>

<p>In some applied fields, I know that there’s a strong preference for unbiased estimators. I think this might be a factor in limiting the use of regularized regression methods in those fields. By trading off some of the variance for bias the LASSO estimates tend to be better controlled than OLS estimates, though the bias could be a downside to folks who really like unbiased estimates.</p>

<p>However, I think this could actually work in LASSO’s favor; since the estimates are biased <em>toward 0</em> (you can see this in the simulation tables, and it’s mentioned in the Stack Exchange post a few paragraphs up), the LASSO estimates are <em>lower bounds</em> on the effect size for a given policy evaluation question! I think this could be a selling point for using LASSO in applied/policy-centric questions since it lets the researcher say something like “look, the effect of this policy is <em>at least</em> 5 whatevers, and possibly a little bigger”.</p>

<p>Models can easily blow up when you’re controlling for a lot of things - individual fixed effects or interactions, for example, can add a lot of predictors to a model. The applied folks I know tend to say they care more/entirely about the parameter estimate of the policy variable and not the control variables, but just having a lot of controls in the model can reduce the precision of the estimates of interest. LASSO might be a good approach for such settings. That said, for the fixed effects case I don’t think the estimates could still be interpreted as “controlling for” the unobservables being captured by the fixed effects, since the fixed effects might be set to 0 if they aren’t sufficiently correlated with the outcome. Does this mean those effects didn’t need to be controlled for? I think the answer is yes… this seems relevant to the “LASSO as variable selector” approach to choosing control variables.</p>

<p>Significance testing is an advantage for OLS over LASSO in applied economics. There are a lot of results out there about significance testing for OLS, and folks understand them (or at least, think they do, which is the same for adoption purposes). Inference under LASSO is a current area of research, and apparently Tibshirani recently came out with <a href="http://statweb.stanford.edu/~tibs/ftp/covtest-talk.pdf">a significance test for the LASSO</a> (I really like the <a href="http://andrewgelman.com/2013/03/18/tibshirani-announces-new-research-result-a-significance-test-for-the-lasso/">discussion of this over at Gelman’s blog</a>).</p>

<p>At some point I’d like to try a “LASSO difference-in-differences with fixed effects” simulation to see what happens.</p>

<p>UPDATE: <a href="http://www.mit.edu/~vchern/NBER/NBER3.pdf">These slides</a> have a good discussion of LASSO in economics and econometrics, as well as some properties of the “LASSO to select, OLS to estimate” approach (“post-LASSO estimator”). Apparently post-LASSO can remove much of the shrinkage bias present in LASSO, and perform nearly as well as an OLS regression on just the relevant covariates.</p>

    <a href="/econometrics/2016/07/16/lasso-ols-sim-1/#disqus_thread">View or add comments</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://akhilrao.github.io//eda/2016/07/02/au-water-trading-2-look-at-data/">
        Australian water trading data, part 2 - zero price transactions
      </a>
    </h1>

    <span class="post-date">02 Jul 2016</span>

    <p>In a <a href="https://akhilrao.github.io/eda/2016/06/29/au-water-trading-1-look-at-data/">previous post</a> I looked at some water trading data from the Australian Bureau of Meteorology. In this post I focus on the zero price transactions.</p>

<p>As mentioned last time, trades can have a zero price for three reasons:</p>

<ol>
  <li>As a rule, water trades between environmental water holders are listed at $0</li>
  <li>A single private user may transfer water they own from one area to another, recording a price of $0</li>
  <li>Some transactions between two private users may be listed as occuring at $0 because entering the price isn’t/wasn’t always mandatory (if I recall correctly, the person said this was more likely in more remote areas)</li>
</ol>

<h2 id="why-do-i-care-about-zero-price-transactions">Why do I care about zero price transactions?</h2>

<p>It has to do with reason 1. Towards the end of the <a href="https://en.wikipedia.org/wiki/2000s_Australian_drought">Millennium Drought</a>, most states had implemented unbundling schemes to separate water access entitlements from land titles. At face value I thought this would be a good thing, since it would lower transactions costs. But there is some discussion that it led to higher prices for environmental water, resulting in more government expenditure than would have occurred without unbundling.</p>

<p>This “world of the second-best” story seems really interesting to me from a policy perspective. Intuitively, it makes sense to me if water is used to produce public goods whose marginal benefits don’t enter into the market - basically a market incompleteness story. I don’t know whether this is actually what happened or not, but it seems at least possible in theory.</p>

<h2 id="doing-stuff-with-the-data">Doing stuff with the data</h2>

<p>I used the same scripts as last time, <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/au-water-trading/prep-trading-data.r"><code class="highlighter-rouge">prep-trading-data.r</code></a> and <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/au-water-trading/water-eda-stuff.r"><code class="highlighter-rouge">water-eda-stuff.r</code></a>, with some small modifications. I uncommented four lines in <code class="highlighter-rouge">prep-trading-data.r</code> to created an indicator variable <code class="highlighter-rouge">zerop</code> in <code class="highlighter-rouge">ents</code> and <code class="highlighter-rouge">alls</code>. <code class="highlighter-rouge">zerop</code> is 1 if the transaction had a price of $0, and 0 if the price was positive. For example,</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ent_data</span><span class="o">$</span><span class="n">zerop</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">dim</span><span class="p">(</span><span class="n">ent_data</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span>
<span class="n">ent_data</span><span class="o">$</span><span class="n">zerop</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">ent_data</span><span class="o">$</span><span class="n">netPrice</span><span class="o">==</span><span class="m">0</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="m">1</span>
</code></pre>
</div>

<p>and similarly for the allocation trades.</p>

<p>In <code class="highlighter-rouge">water-eda-stuff.r</code>, I updated the <code class="highlighter-rouge">ddply()</code>, <code class="highlighter-rouge">join()</code>, and <code class="highlighter-rouge">melt()</code> calls to include <code class="highlighter-rouge">zerop</code> as a variable to sort and merge on.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## monthly trading
</span><span class="n">ents_m</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">ents</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">from_state</span><span class="p">,</span><span class="n">interstate</span><span class="p">,</span><span class="n">zerop</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_ents</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">price_ents</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]),</span><span class="n">n_ents</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">np_ents</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]))</span>

<span class="n">alls_m</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">alls</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">from_state</span><span class="p">,</span><span class="n">interstate</span><span class="p">,</span><span class="n">zerop</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_alls</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">price_alls</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]),</span><span class="n">n_alls</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">np_alls</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]))</span>

<span class="c1">### merge alls and ents
</span><span class="n">trades_m</span> <span class="o">&lt;-</span> <span class="n">join</span><span class="p">(</span><span class="n">alls_m</span><span class="p">,</span><span class="n">ents_m</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"MonthOfTrade"</span><span class="p">,</span><span class="s2">"mdb"</span><span class="p">,</span><span class="s2">"from_state"</span><span class="p">,</span><span class="s2">"interstate"</span><span class="p">,</span><span class="s2">"zerop"</span><span class="p">),</span><span class="n">type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span><span class="n">match</span><span class="o">=</span><span class="s2">"first"</span><span class="p">)</span>
<span class="n">trades_m</span><span class="p">[(</span><span class="n">is.na</span><span class="p">(</span><span class="n">trades_m</span><span class="p">))]</span> <span class="o">&lt;-</span> <span class="m">0</span> <span class="c1"># replace NaN and NA with 0
</span>
<span class="c1">### melt trades_m
</span><span class="n">trades_m_melted</span> <span class="o">&lt;-</span> <span class="n">melt</span><span class="p">(</span><span class="n">trades_m</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">14</span><span class="p">)],</span><span class="n">id</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="s2">"MonthOfTrade"</span><span class="p">,</span><span class="s2">"mdb"</span><span class="p">,</span><span class="s2">"from_state"</span><span class="p">,</span><span class="s2">"interstate"</span><span class="p">,</span><span class="s2">"zerop"</span><span class="p">))</span> <span class="c1"># useful for plots later
</span></code></pre>
</div>

<p>From here the dataset is ready to make the plots I want.</p>

<h2 id="pictures">Pictures</h2>

<p>Let’s look at the priced/unpriced transactions by state.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"C:/Users/Akhil/Documents/akhilrao.github.io/public/code/au-water-trading/water-eda-stuff.RData"</span><span class="p">)</span> <span class="c1"># load workspace
</span>
<span class="c1">## drop everything before 2008
</span><span class="n">trades_m</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">trades_m</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">)</span>
<span class="n">trades_m_melted</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">)</span>

<span class="c1">### facet by state, color by zero price/not
#### volumes over time - allocations
</span><span class="n">trade_vols_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"v_alls"</span><span class="p">),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">zerop</span><span class="p">)))</span>

<span class="n">trade_vols_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Allocation trading by state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Volume (ML) traded per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Price"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"positive"</span><span class="p">,</span><span class="s2">"zero"</span><span class="p">))</span></code></pre></figure>

<p><img src="/public/images/eda-water-2/unnamed-chunk-1-1.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#### volumes over time - entitlements
</span><span class="n">trade_vols_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"v_ents"</span><span class="p">),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">zerop</span><span class="p">)))</span>

<span class="n">trade_vols_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Entitlement trading by state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Volume (ML) traded per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Price"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"positive"</span><span class="p">,</span><span class="s2">"zero"</span><span class="p">))</span></code></pre></figure>

<p><img src="/public/images/eda-water-2/unnamed-chunk-1-2.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#### counts over time - allocations
</span><span class="n">trade_counts_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"n_alls"</span><span class="p">),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">zerop</span><span class="p">)))</span>

<span class="n">trade_counts_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Allocation trading by state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Number of trades per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Price"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"positive"</span><span class="p">,</span><span class="s2">"zero"</span><span class="p">))</span></code></pre></figure>

<p><img src="/public/images/eda-water-2/unnamed-chunk-1-3.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#### counts over time - entitlements
</span><span class="n">trade_counts_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"n_ents"</span><span class="p">),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">zerop</span><span class="p">)))</span>

<span class="n">trade_counts_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Entitlement trading by state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Number of trades per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Price"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"positive"</span><span class="p">,</span><span class="s2">"zero"</span><span class="p">))</span></code></pre></figure>

<p><img src="/public/images/eda-water-2/unnamed-chunk-1-4.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<p>(<em>Still no Northern Territory or Australian Capital Territory. I haven’t audited my code yet to see where I might be dropping them, or looked to see if they’re in the data at all. It’s on my to-do list.</em>)</p>

<p>Takeaways:</p>

<ol>
  <li>
    <p>There are very few transactions with a positive price outside of New South Wales and Victoria, and few high-volume transactions. One story might be that these states are more arid, with fewer private players and less liquid water markets. NSW and Victoria account for most of the Murray-Darling Basin, so it makes sense to me that they’d have more positive price transactions. Queensland and Tasmania in particular don’t seem to have very liquid water markets, at least as measured by trades with a positive price.</p>
  </li>
  <li>
    <p>Not a lot of difference between positive price and zero price entitlement transactions overall. The exception is victoria, where the number of positive price entitlement trades seems to have fallen over time, while the number of zero price transactions has increased.</p>
  </li>
  <li>
    <p>New South Wales seems to have seen the biggest increase in zero price allocation trades over this period, both in terms of volume traded and number of trades per month. Victoria also saw similar increases, but they seem to be of smaller magnitude.</p>
  </li>
  <li>
    <p>There’s more activity in allocation trades than entitlement trades.</p>
  </li>
</ol>

<p>At a first approximation it seems like these data may offer some support for the second-best story of unbundling.</p>

<p>Unfortunately, zero price transactions are not a perfect indicator of environmental water trades - reasons 2 and 3 are still candidate explanations. What I need is a way to check the annual levels of environmental water trading implied by zero price trades against some “ground truth” measure of environmental water trades. The Australian Water Markets Reports may offer a way to do that.</p>

<p>I have a copy of the AWMR tables for 2013-14 hosted <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/au-water-trading/awmr2013-14_dataTables_v1.0.0.xlsx">here</a>, or you can get them from the Department of Agriculture and Water Resources <a href="http://www.agriculture.gov.au/abares/publications/display?url=http://143.188.17.20/anrdl/DAFFService/display.php?fid=pb_awmr_d9aawr20151211.xml">here</a>. Table 21 lists “Environmental allocation trade among southern Murray-Darling Basin water systems, 2013-14”, so I can check the zero price trades in those water systems* against these. I’ll do that in the next post on this subject. If it checks out, that’s a good sign and I can look at the AWMRs for other years to see if I can do something similar.</p>

<p>*(“water systems” is a finer level of aggregation than “state”, so I’ll have to modify <code class="highlighter-rouge">water-eda-stuff.r</code>. <code class="highlighter-rouge">prep-trading-data.r</code> should be fine.)</p>

<p>Ideally I’d like to use the monthly data to run some regressions to see the effect of unbundling on environmental transactions, but this may not be possible. One problem is the difficulty of defining environmental transactions at the monthly level.</p>

<p>Another problem is the variation in policy implementation - I believe that South Australia implemented unbundling along the River Murray Prescribed Water Course starting July 1st, 2009, and that Victoria implemented unbundling on July 1st, 2007 (Northern Victoria) and July 1st, 2008 (Southern Victoria). I don’t yet know when New South Wales implemented unbundling, but my guess is around when Victoria did or sooner.</p>

<p>These dates are all really early in my sample, or for regions that may not have good counterfactuals. In the case of Victorian unbundling, I don’t have any entitlement trade data before 2009. In the case of South Australia, the RMPWC is where most of the trading activity occurs, so any control region would probably have to be located in Victoria or NSW. This makes a credibly identified setup to get at the effects of unbundling a bit more challenging, but possibly still doable. In a future post I’ll describe what one such setup might look like.</p>

    <a href="/eda/2016/07/02/au-water-trading-2-look-at-data/#disqus_thread">View or add comments</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://akhilrao.github.io//2016/06/30/i-love-npp/">
        I love Notepad++
      </a>
    </h1>

    <span class="post-date">30 Jun 2016</span>

    <p>A while back Github Pages upgraded to Jekyll 3.0. As a result, only <code class="highlighter-rouge">kramdown</code> is supported for Jekyll sites hosted on Github Pages.</p>

<p>Seeing as I didn’t pay close attention to what was going on, I spent a while very confused and frustrated trying to figure out why all my MathJax wasn’t displaying properly. Once I figured out what the upgrade was doing, I spent some more time confused and frustrated trying to fix the problem.</p>

<p><a href="http://tobanwiebe.com/blog/2016/02/mathjax-kramdown">This blog post by Toban Wiebe</a> explained what was going on in words I can grok. Unfortunately, I am one of those people with a lot of old posts to convert.</p>

<p>I’ve been reading through “<a href="https://automatetheboringstuff.com/">Automate the Boring Stuff with Python</a>” this summer, so I figured this was a perfect project - write a Python script to convert <code class="highlighter-rouge">redcarpet</code>-acceptable delimiters like <code class="highlighter-rouge">\\(</code> and <code class="highlighter-rouge">\\{</code> to <code class="highlighter-rouge">kramdown</code>-acceptable delimiters like <code class="highlighter-rouge">$$</code> and <code class="highlighter-rouge">\{</code>. I started down that path, and even got as far as figuring out the appropriate regular expressions and writing a first draft of a script.</p>

<p>Then I remembered that <a href="https://notepad-plus-plus.org/">Notepad++</a> (my preferred text editor) has a “Replace All in All Opened Documents” function. Like any good myopic optimizer, I stopped writing that script immediately and pulled up Notepad++.</p>

<p>Problem solved. Hooray for Notepad++!</p>

<p>(It seems like MathJax doesn’t always load with the page anymore, but a couple refreshes solves the problem. Not sure what’s up with that.)</p>

    <a href="/2016/06/30/i-love-npp/#disqus_thread">View or add comments</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://akhilrao.github.io//eda/2016/06/29/au-water-trading-1-look-at-data/">
        A look at some Australian water trading data
      </a>
    </h1>

    <span class="post-date">29 Jun 2016</span>

    <p><em>This is my first attempt at using knitr and ggplot2. The scripts to reproduce and extend everything discussed here are <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/au-water-trading">here</a>. I converted the knitted Rmarkdown file to markdown with the help of this <a href="http://brooksandrew.github.io/simpleblog/articles/blogging-with-r-markdown-and-jekyll-using-knitr/">post</a> by Andrew Brooks.</em></p>

<p>I’m currently working on two projects: one is about orbital debris and satellites launches (what my previous post was about), and the other is about trading in Australian water markets (what this post is about). In this post I’m going to describe some of the water data I have.</p>

<h2 id="why-australian-water-markets">Why Australian water markets?</h2>

<p>I’ve liked the idea of water markets since I learned about <a href="http://www.latimes.com/local/california/la-me-water-rights-legal-20150629-story.html">California’s messed up water rights</a> as a <a href="http://www.corola.org/">Coro Fellow</a> (FPPA LA ‘14, fun times). Australia actually has pretty well-defined water markets with some historical daily trading data, so I started there.</p>

<p>Plus, water markets lend themselves to some great awful puns about market liquidity and trade volumes.</p>

<h2 id="a-little-bit-about-the-markets">A little bit about the markets</h2>

<p>Australian water trading can broadly be classified into two categories: allocation trades and entitlement trades. Allocation trades are short-term transfers of an amount of water, lasting for the remainder of the water year (water years are July 1st xxx(y)-June 30th xxx(y+1)). Entitlement trades are transfers of the rights to water from a given source. Entitlement transfers can further be divided into permanent/ongoing and leases.</p>

<p>I say “markets” instead of “market” because each state has some different laws relating to water trading within its borders. But the broad allocations/entitlements distinction still stands. The <a href="http://www.nationalwatermarket.gov.au/about/products.html">implementation details vary</a>. (I’m saying “entitlement” instead of “access entitlement” for brevity.)</p>

<p>A given water resource will be divided into consumptive and non-consumptive use. Consumptive use is for private purposes like irrigation, urban use, etc., while non-consumptive use is for things like generating hydroelectricity or to guarantee the stability of the environment in that region. Tradeable water rights are defined as shares of a consumptive pool from a given water source. Water resource plans define the amount of water available to a consumptive pool. The national water market’s <a href="http://www.nationalwatermarket.gov.au/about/resources.html">resources page</a> has more information on how this works.</p>

<p>There’s a lot of state-level heterogeneity in how this all looks in practice, but my understanding is that these broad statements are true across the country.</p>

<h2 id="what-are-the-data">What are the data?</h2>

<p>The data used for this post are publicly available at the Bureau of Meteorology’s <a href="http://www.nationalwatermarket.gov.au/water-market-reports/download-data.html">Water Market Information page</a>, specifically the “trade history” dataset.</p>

<p>The dataset describes all of the water transactions that occurred between 2009-2014. A lot of the trades have a zero price listed. I spoke to one of the people at the Bureau of Meteorology about this some time back, and he told me that this can be for three reasons:</p>

<ol>
  <li>As a rule, water trades between environmental water holders are listed at $0</li>
  <li>A single private user may transfer water they own from one area to another, recording a price of $0</li>
  <li>Some transactions between two private users may be listed as occuring at $0 because entering the price isn’t/wasn’t always mandatory (if I recall correctly, the person said this was more likely in more remote areas)</li>
</ol>

<p>One of the things I want to check eventually is how the distributions of zero price trades compares to the distribution of positive price trades, to see if there’s anything interesting going on there.</p>

<p>One of my goals for the future is to learn to use mapping tools to get data out of maps like <a href="http://www.bom.gov.au/jsp/awap/rain/index.jsp">these</a>. Rainfall information would be really useful for this project. Along the way, it would help to find a shapefile for a map of Australia with the Murray-Darling Basin and the different water systems marked out.</p>

<h2 id="doing-stuff-with-the-data">Doing stuff with the data</h2>

<p>I’m going to skip all the data cleaning and prep work (<a href="https://en.wikipedia.org/wiki/Data_wrangling">wrangling</a>). It’s in the script <a href="https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/au-water-trading/prep-trading-data.r"><code class="highlighter-rouge">prep-trading-data.r</code></a>.</p>

<p><code class="highlighter-rouge">prep-trading-data.r</code> outputs two csv files, one each for allocation and entitlement trades. I used <code class="highlighter-rouge">rm(list=ls())</code> liberally throughout the <code class="highlighter-rouge">prep-trading-data.r</code>, so consider yourself warned. Don’t use the script if you have other things you want to keep in your workspace.</p>

<p><code class="highlighter-rouge">prep-trading-data.r</code> does a bunch of useful things for me, like create an indicator variable for whether a trade was in the Murray-Darling Basin or not, a categorical variable describing the origin and destination states of a trade, and get rid of 14 observations with years like 2103 (at which point we’ll have no water, so they’re clearly wrong). The most tedious part of writing it was going through the <a href="http://www.agriculture.gov.au/abares/publications/display?url=http://143.188.17.20/anrdl/DAFFService/display.php?fid=pb_awmr_d9aawr20151211.xml">Australian Water Markets Report 2013-14</a> to figure out whether a given water system was in the Murray-Darling Basin or not.</p>

<p><code class="highlighter-rouge">ents</code> and <code class="highlighter-rouge">alls</code> are from the csv files of prepped daily water trading data. From there I used <code class="highlighter-rouge">[water-eda-stuff.r](https://github.com/akhilrao/akhilrao.github.io/tree/master/public/code/au-water-trading/water-eda-stuff.r)</code> to do a little more processing and make some tables and pictures. The data processing in <code class="highlighter-rouge">water-eda-stuff.r</code> is below:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## load libraries
</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span>

<span class="c1">## run prep script
</span><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="n">ls</span><span class="p">())</span> <span class="c1"># I use these liberally. Caveat emptor.
</span><span class="n">source</span><span class="p">(</span><span class="s2">"prep-trading-data.r"</span><span class="p">)</span> <span class="c1"># does some stuff to make the data nicer to use
</span>
<span class="c1">## monthly trading
</span><span class="n">ents_m</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">ents</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">from_state</span><span class="p">,</span><span class="n">interstate</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_ents</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">price_ents</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]),</span><span class="n">n_ents</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">np_ents</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]))</span>
<span class="n">alls_m</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">alls</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">from_state</span><span class="p">,</span><span class="n">interstate</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_alls</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">price_alls</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]),</span><span class="n">n_alls</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">np_alls</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]))</span>

<span class="c1">### merge alls and ents
</span><span class="n">trades_m</span> <span class="o">&lt;-</span> <span class="n">join</span><span class="p">(</span><span class="n">alls_m</span><span class="p">,</span><span class="n">ents_m</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"MonthOfTrade"</span><span class="p">,</span><span class="s2">"mdb"</span><span class="p">,</span><span class="s2">"from_state"</span><span class="p">,</span><span class="s2">"interstate"</span><span class="p">),</span><span class="n">type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span><span class="n">match</span><span class="o">=</span><span class="s2">"first"</span><span class="p">)</span>
<span class="n">trades_m</span><span class="p">[(</span><span class="n">is.na</span><span class="p">(</span><span class="n">trades_m</span><span class="p">))]</span> <span class="o">&lt;-</span> <span class="m">0</span> <span class="c1"># replace NaN and NA with 0
</span>
<span class="c1">### melt trades_m
</span><span class="n">trades_m_melted</span> <span class="o">&lt;-</span> <span class="n">melt</span><span class="p">(</span><span class="n">trades_m</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">)],</span><span class="n">id</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="s2">"MonthOfTrade"</span><span class="p">,</span><span class="s2">"mdb"</span><span class="p">,</span><span class="s2">"from_state"</span><span class="p">,</span><span class="s2">"interstate"</span><span class="p">))</span> <span class="c1"># useful for plots later
</span>
<span class="c1">## yearly trading
</span><span class="n">ents_y</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">ents</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">from_state</span><span class="p">,</span><span class="n">interstate</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_ents</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">price_ents</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]),</span><span class="n">n_ents</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">np_ents</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]))</span>
<span class="n">alls_y</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">alls</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">from_state</span><span class="p">,</span><span class="n">interstate</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_alls</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">price_alls</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]),</span><span class="n">n_alls</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">quantityTraded</span><span class="p">),</span><span class="n">np_alls</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">PricePerML</span><span class="p">[</span><span class="n">PricePerML</span><span class="o">!=</span><span class="m">0</span><span class="p">]))</span>

<span class="c1">### merge alls and ents
</span><span class="n">trades_y</span> <span class="o">&lt;-</span> <span class="n">join</span><span class="p">(</span><span class="n">alls_y</span><span class="p">,</span><span class="n">ents_y</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="s2">"mdb"</span><span class="p">,</span><span class="s2">"from_state"</span><span class="p">,</span><span class="s2">"interstate"</span><span class="p">),</span><span class="n">type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span><span class="n">match</span><span class="o">=</span><span class="s2">"first"</span><span class="p">)</span>
<span class="n">trades_y</span><span class="p">[(</span><span class="n">is.na</span><span class="p">(</span><span class="n">trades_y</span><span class="p">))]</span> <span class="o">&lt;-</span> <span class="m">0</span> <span class="c1"># replace NaN and NA with 0
</span>
<span class="c1">### yearly summary
</span><span class="n">yearly_summary</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">trades_y</span><span class="p">,</span><span class="err">.</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="n">summarize</span><span class="p">,</span><span class="n">v_alls</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">v_alls</span><span class="p">),</span><span class="n">v_ents</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">v_ents</span><span class="p">),</span><span class="n">n_alls</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">n_alls</span><span class="p">),</span><span class="n">n_ents</span><span class="o">=</span><span class="n">sum</span><span class="p">(</span><span class="n">n_ents</span><span class="p">))</span> <span class="c1"># for a summary table
</span></code></pre>
</div>

<p>Just some <code class="highlighter-rouge">ddply()</code>, <code class="highlighter-rouge">join()</code>, and <code class="highlighter-rouge">melt()</code> to make pictures and tables easier later. <code class="highlighter-rouge">n_ents</code> and <code class="highlighter-rouge">n_alls</code> are the number of entitlement and allocation trades respectively, while <code class="highlighter-rouge">v_ents</code> and <code class="highlighter-rouge">v_alls</code> are the total monthly volume of entitlements and allocations traded.</p>

<p>(I’m still a noob at this whole “generating pretty things in markdown” business, so I used this handy online <a href="http://www.tablesgenerator.com/markdown_tables#">markdown table generator</a> to make this table.)</p>

<table>
  <thead>
    <tr>
      <th>year</th>
      <th>Allocation trades (ML)</th>
      <th>Entitlement trades (ML)</th>
      <th>Number of allocation trades</th>
      <th>Number of entitlement trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2004</td>
      <td>1898</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2005</td>
      <td>980</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2006</td>
      <td>1256</td>
      <td>0</td>
      <td>38</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2007</td>
      <td>4279</td>
      <td>0</td>
      <td>76</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2008</td>
      <td>1090</td>
      <td>0</td>
      <td>17</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2009</td>
      <td>873878.133</td>
      <td>449766.741</td>
      <td>8119</td>
      <td>2895</td>
    </tr>
    <tr>
      <td>2010</td>
      <td>3373516.237</td>
      <td>1385914.681</td>
      <td>18434</td>
      <td>6666</td>
    </tr>
    <tr>
      <td>2011</td>
      <td>5527076.803</td>
      <td>2261956.205</td>
      <td>10070</td>
      <td>7509</td>
    </tr>
    <tr>
      <td>2012</td>
      <td>5565003.714</td>
      <td>1301803.735</td>
      <td>15099</td>
      <td>7804</td>
    </tr>
    <tr>
      <td>2013</td>
      <td>7288640.034</td>
      <td>1915709.35</td>
      <td>30058</td>
      <td>7636</td>
    </tr>
    <tr>
      <td>2014</td>
      <td>2975364.894</td>
      <td>827862.547</td>
      <td>15160</td>
      <td>2316</td>
    </tr>
  </tbody>
</table>

<p>Note that I’m aggregating these by calendar year, not water year. “ML” stands for megaliter (1 million liters). The 2014 data only goes till September, so the apparent dropoff in trading might be mostly truncated data.</p>

<h3 id="pictures">Pictures!</h3>

<p>This is the real reason I wrote this post: pictures!</p>

<p>To get these to load in knitr code chunks, the script <code class="highlighter-rouge">water-eda.r</code> saves the cleaned data in a file called <code class="highlighter-rouge">water-eda-stuff.RData</code>. I’m going to focus on three quantities: volume traded (megaliters per month), trade volume (number of trades per month), and price per megaliter (Australian dollars).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">load</span><span class="p">(</span><span class="s2">"C:/Users/Akhil/Documents/akhilrao.github.io/public/code/au-water-trading/water-eda-stuff.RData"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="c1">## drop everything before 2008
</span><span class="n">trades_m</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">trades_m</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">)</span>
<span class="n">trades_m_melted</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">)</span>

<span class="c1">## make plots
### volume over time
</span><span class="n">trade_vols</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"v_ents"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"v_alls"</span><span class="p">)),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">mdb</span><span class="p">)))</span>

<span class="n">trade_vols</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">variable</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"In MDB"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="s2">"Yes"</span><span class="p">))</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Water volume traded in and out of MDB"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Volume (ML) traded per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/images/eda-water-1/unnamed-chunk-1-1.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### trades over time
</span><span class="n">trade_counts</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"n_ents"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"n_alls"</span><span class="p">)),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">mdb</span><span class="p">)))</span>

<span class="n">trade_counts</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">variable</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"In MDB"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="s2">"Yes"</span><span class="p">))</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Trades in and out of MDB"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Number of trades per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/images/eda-water-1/unnamed-chunk-1-2.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### prices over time
</span><span class="n">trade_prices</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">intersect</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"price_ents"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">)),</span><span class="n">intersect</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"price_alls"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">))),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">mdb</span><span class="p">)))</span>  <span class="c1"># only looking at observations with positive prices
</span>
<span class="n">trade_prices</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">se</span><span class="o">=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">variable</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"In MDB"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="s2">"Yes"</span><span class="p">))</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Monthly average trade prices in and out of MDB"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"AUD"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/images/eda-water-1/unnamed-chunk-1-3.svg" alt="plot of chunk unnamed-chunk-1" /></p>

<p>Three things I see here:</p>

<ol>
  <li>More trading of entitlements and allocations inside the MDB than outside, both in terms of volumes of water traded as well as number of trades.</li>
  <li>Allocation trading inside the MDB has been increasing faster than allocation trading outside the MDB, while entitlement trading in both regions seem to follow similar trends.</li>
  <li>Average monthly prices per megaliter seem about the same inside or outside the MDB. Entitlement prices seem to have been going up over time.</li>
</ol>

<p>This makes sense; the Murray-Darling Basin accounts for most of Australia’s water use, so I expected to see more activity inside the MDB than outside. 4 states sit inside the MDB: New South Wales, Victoria, Queensland, and South Australia. New South Wales and Victoria have the most area inside the Basin, so we might expect the action in the Basin to be driven by those two. Let’s take a look:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">load</span><span class="p">(</span><span class="s2">"C:/Users/Akhil/Documents/akhilrao.github.io/public/code/au-water-trading/water-eda-stuff.RData"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="c1">## drop everything before 2008
</span><span class="n">trades_m</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">trades_m</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">)</span>
<span class="n">trades_m_melted</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">)</span>

<span class="c1">## make plots
### volumes over time
</span><span class="n">trade_vols_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"v_ents"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"v_alls"</span><span class="p">)),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">variable</span><span class="p">)))</span>

<span class="n">trade_vols_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Product type"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"Allocations"</span><span class="p">,</span><span class="s2">"Entitlements"</span><span class="p">))</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Water volume traded in each state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Volume (ML) traded per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/images/eda-water-1/unnamed-chunk-2-1.svg" alt="plot of chunk unnamed-chunk-2" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### counts over time
</span><span class="n">trade_counts_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"n_ents"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"n_alls"</span><span class="p">)),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">variable</span><span class="p">)))</span>

<span class="n">trade_counts_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Product type"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"Allocations"</span><span class="p">,</span><span class="s2">"Entitlements"</span><span class="p">))</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Trades in each state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Number of trades per month"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/images/eda-water-1/unnamed-chunk-2-2.svg" alt="plot of chunk unnamed-chunk-2" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### prices over time
</span><span class="n">trade_prices_state</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">intersect</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"price_ents"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">)),</span><span class="n">intersect</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">variable</span><span class="o">==</span><span class="s2">"price_alls"</span><span class="p">),</span><span class="n">which</span><span class="p">(</span><span class="n">trades_m_melted</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">))),],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MonthOfTrade</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">variable</span><span class="p">)))</span> 

<span class="n">trade_prices_state</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">NA</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">from_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Product type"</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"Allocations"</span><span class="p">,</span><span class="s2">"Entitlements"</span><span class="p">))</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Monthly average trade prices in each state"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"AUD"</span><span class="p">)</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/images/eda-water-1/unnamed-chunk-2-3.svg" alt="plot of chunk unnamed-chunk-2" /></p>

<p>(<em>Northern Territory seems to be missing from my data. Might be a coding error on my part.</em>)</p>

<ol>
  <li>It looks like the increase in volume traded and trade volume for the allocations is driven by Victoria and New South Wales, with New South Wales having some bigger months in terms of both amount traded and frequency of trades.</li>
  <li>Overall prices per megaliter seem fairly flat, with the exception of entitlements in New South Wales, which seem to be increasing.</li>
  <li>Not a lot of trades with positive prices in Queensland, I don’t think any in Tasmania.</li>
</ol>

<p>I’ll look at more cuts of this data in a future post.</p>

    <a href="/eda/2016/06/29/au-water-trading-1-look-at-data/#disqus_thread">View or add comments</a>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="https://akhilrao.github.io/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>

<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



